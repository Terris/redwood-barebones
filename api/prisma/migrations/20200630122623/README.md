# Migration `20200630122623`

This migration has been generated by Terris Kremer at 6/30/2020, 12:26:23 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `test-one`.`Book` (
`categoryId` varchar(191)  ,`covers` varchar(191)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` varchar(191) NOT NULL  ,`isbn` varchar(191)   ,`metaData` varchar(191)   ,`publisherId` varchar(191)  ,`subtitle` varchar(191)   ,`title` varchar(191) NOT NULL  ,`updatedAt` datetime(3)   ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`Author` (
`id` varchar(191) NOT NULL  ,`name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`Category` (
`id` varchar(191) NOT NULL  ,`name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`Publisher` (
`id` varchar(191) NOT NULL  ,`name` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`User` (
`configuration` varchar(191)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`createdByTier` boolean NOT NULL DEFAULT false ,`email` varchar(191) NOT NULL  ,`firstname` varchar(191)   ,`handle` varchar(191) NOT NULL  ,`id` varchar(191) NOT NULL  ,`lastname` varchar(191)   ,`uid` varchar(191)   ,`updatedAt` datetime(3)   ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`Token` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` varchar(191) NOT NULL  ,`token` varchar(191) NOT NULL  ,`updatedAt` datetime(3)   ,`userId` varchar(191)  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`Label` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` varchar(191) NOT NULL  ,`name` varchar(191) NOT NULL  ,`updatedAt` datetime(3)   ,`userId` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`Loan` (
`beginAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`endAt` datetime(3)   ,`id` varchar(191) NOT NULL  ,`updatedAt` datetime(3)   ,`userId` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`Localisation` (
`address` varchar(191) NOT NULL  ,`bookId` varchar(191)  ,`id` varchar(191) NOT NULL  ,`name` varchar(191) NOT NULL  ,`userId` varchar(191)  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`Ownership` (
`bookId` varchar(191) NOT NULL ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` varchar(191) NOT NULL  ,`loanId` varchar(191)  ,`note` varchar(191)   ,`rate` int   ,`updatedAt` datetime(3)   ,`userId` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`_AuthorToBook` (
`A` varchar(191) NOT NULL ,`B` varchar(191) NOT NULL 
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`_Contact` (
`A` varchar(191) NOT NULL ,`B` varchar(191) NOT NULL 
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test-one`.`_LabelToOwnership` (
`A` varchar(191) NOT NULL ,`B` varchar(191) NOT NULL 
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `Book.isbn` ON `test-one`.`Book`(`isbn`)

CREATE UNIQUE INDEX `Author.name` ON `test-one`.`Author`(`name`)

CREATE UNIQUE INDEX `Category.name` ON `test-one`.`Category`(`name`)

CREATE UNIQUE INDEX `Publisher.name` ON `test-one`.`Publisher`(`name`)

CREATE UNIQUE INDEX `User.uid` ON `test-one`.`User`(`uid`)

CREATE UNIQUE INDEX `User.handle` ON `test-one`.`User`(`handle`)

CREATE UNIQUE INDEX `User.email` ON `test-one`.`User`(`email`)

CREATE UNIQUE INDEX `Token.token` ON `test-one`.`Token`(`token`)

CREATE UNIQUE INDEX `LabelOfUser` ON `test-one`.`Label`(`userId`,`name`)

CREATE UNIQUE INDEX `BookOfUser` ON `test-one`.`Ownership`(`bookId`,`userId`)

CREATE UNIQUE INDEX `_AuthorToBook_AB_unique` ON `test-one`.`_AuthorToBook`(`A`,`B`)

CREATE  INDEX `_AuthorToBook_B_index` ON `test-one`.`_AuthorToBook`(`B`)

CREATE UNIQUE INDEX `_Contact_AB_unique` ON `test-one`.`_Contact`(`A`,`B`)

CREATE  INDEX `_Contact_B_index` ON `test-one`.`_Contact`(`B`)

CREATE UNIQUE INDEX `_LabelToOwnership_AB_unique` ON `test-one`.`_LabelToOwnership`(`A`,`B`)

CREATE  INDEX `_LabelToOwnership_B_index` ON `test-one`.`_LabelToOwnership`(`B`)

ALTER TABLE `test-one`.`Book` ADD FOREIGN KEY (`categoryId`) REFERENCES `test-one`.`Category`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `test-one`.`Book` ADD FOREIGN KEY (`publisherId`) REFERENCES `test-one`.`Publisher`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `test-one`.`Token` ADD FOREIGN KEY (`userId`) REFERENCES `test-one`.`User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `test-one`.`Label` ADD FOREIGN KEY (`userId`) REFERENCES `test-one`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test-one`.`Loan` ADD FOREIGN KEY (`userId`) REFERENCES `test-one`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test-one`.`Localisation` ADD FOREIGN KEY (`bookId`) REFERENCES `test-one`.`Book`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `test-one`.`Localisation` ADD FOREIGN KEY (`userId`) REFERENCES `test-one`.`User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `test-one`.`Ownership` ADD FOREIGN KEY (`bookId`) REFERENCES `test-one`.`Book`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test-one`.`Ownership` ADD FOREIGN KEY (`loanId`) REFERENCES `test-one`.`Loan`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `test-one`.`Ownership` ADD FOREIGN KEY (`userId`) REFERENCES `test-one`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test-one`.`_AuthorToBook` ADD FOREIGN KEY (`A`) REFERENCES `test-one`.`Author`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test-one`.`_AuthorToBook` ADD FOREIGN KEY (`B`) REFERENCES `test-one`.`Book`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test-one`.`_Contact` ADD FOREIGN KEY (`A`) REFERENCES `test-one`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test-one`.`_Contact` ADD FOREIGN KEY (`B`) REFERENCES `test-one`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test-one`.`_LabelToOwnership` ADD FOREIGN KEY (`A`) REFERENCES `test-one`.`Label`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test-one`.`_LabelToOwnership` ADD FOREIGN KEY (`B`) REFERENCES `test-one`.`Ownership`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200630122623
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,115 @@
+datasource DS {
+  provider = "mysql"
+  url = "***"
+}
+
+generator client {
+  provider      = "prisma-client-js"
+  binaryTargets = env("BINARY_TARGET")
+}
+
+// Define your own datamodels here and run `yarn redwood db save` to create
+// migrations for them.
+model Book {
+  id String @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime?
+  title String
+  subtitle String?
+  covers String?
+  isbn String? @unique
+  metaData String?
+  localisations Localisation[]
+  authors Author[] @relation(references: [id])
+  ownerships Ownership[]
+}
+
+model Author {
+  id String @id @default(cuid())
+  name String @unique
+  books Book[] @relation(references: [id])
+}
+
+model Category {
+  id String @id @default(cuid())
+  name String @unique
+  books Book[]
+}
+
+model Publisher {
+  id String @id @default(cuid())
+  name String @unique
+  books Book[]
+}
+
+model User {
+  id String @id @default(cuid())
+  uid String? @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime?
+  handle String @unique
+  email String @unique
+  lastname String?
+  firstname String?
+  createdByTier Boolean @default(false)
+  tokens Token[]
+  configuration String?
+  ownerships Ownership[]
+  localisations Localisation[]
+  contacts User[] @relation("Contact", references: [id])
+  contactOf User[] @relation("Contact", references: [id])
+}
+
+model Token {
+  id String @id @default(cuid())
+  token String @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime?
+}
+
+
+model Label {
+  id String @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime?
+  name String
+  user User @relation(fields: [userId], references: [id])
+  userId String
+  ownerships Ownership[] @relation(references: [id])
+
+  @@unique([userId,name], name: "LabelOfUser")
+}
+
+model Loan {
+  id String @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime?
+  beginAt DateTime @default(now())
+  endAt DateTime?
+  user User @relation(fields: [userId], references: [id])
+  userId String
+  ownerships Ownership[]
+}
+
+model Localisation {
+  id String @id @default(cuid())
+  name String
+  address String
+}
+
+model Ownership {
+  id String @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime?
+  rate Int?
+  note String?
+  book Book @relation(fields: [bookId], references: [id])
+  bookId String
+  labels Label[] @relation(references: [id])
+  loanedIn Loan? @relation(fields: [loanId], references: [id])
+  loanId String?
+  user User @relation(fields: [userId], references: [id])
+  userId String
+
+  @@unique([bookId, userId], name: "BookOfUser")
+}
```


